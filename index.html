---
layout: document.njk
---

<h1>Hexcolor Words</h1>

<div class="search-container">
  <label for="searchInput"
    >Search {{colors.length}} colors by name or hex</label
  >
  <div
    style="
      display: flex;
      gap: 0.5rem;
      justify-content: center;
      align-items: center;
    "
  >
    <input type="text" id="searchInput" class="search-input" />
    <button type="button" id="clearSearchBtn" class="search-clear-btn">
      Clear
    </button>
  </div>
</div>
<button id="openModalBtn" style="margin: 2rem auto; display: block">
  Suggest a missing color
</button>
<div class="modal" id="suggestModal">
  <div class="modal-content">
    <button class="close" id="closeModalBtn" aria-label="Close">&times;</button>
    <h2>Suggest a missing color</h2>
    <form id="suggestColorForm">
      <div>
        <label for="suggestHex">Hex code:</label>
        <input
          type="text"
          id="suggestHex"
          name="hex"
          required
          pattern="#?[A-Fa-f0-9]{6}"
        />
      </div>
      <div>
        <label for="suggestName">Name:</label>
        <input type="text" id="suggestName" name="name" required />
      </div>
      <div>
        <label for="suggestUrl">URL:</label>
        <input type="url" id="suggestUrl" name="url" required />
      </div>
      <button type="submit">Submit</button>
    </form>
  </div>
</div>

<ul class="grid">
  {% for color in colors %}
  <li>
    <article class="color-block" style="background:{{ color.hex }}">
      <span class="hex">{{ color.hex }}</span>
      <a href="{{ color.url }}" target="_blank" class="name"
        >{{ color.name }}</a
      >
    </article>
  </li>
  {% endfor %}
</ul>

<script>
  document.addEventListener("DOMContentLoaded", function () {
    const input = document.getElementById("searchInput");
    input.addEventListener("input", function (e) {
      const val = e.target.value.toLowerCase();
      document.querySelectorAll(".grid > li").forEach((block) => {
        const hex = block.querySelector(".hex").textContent.toLowerCase();
        const name = block.querySelector(".name").textContent.toLowerCase();
        if (hex.startsWith(val) || name.startsWith(val) || val === "") {
          block.classList.remove("hide");
        } else {
          block.classList.add("hide");
        }
      });
    });

    const clearSearchBtn = document.getElementById("clearSearchBtn");
    const searchInput = document.getElementById("searchInput");
    clearSearchBtn.addEventListener("click", function () {
      searchInput.value = "";
      searchInput.dispatchEvent(new Event("input"));
      searchInput.focus();
    });

    const openModalBtn = document.getElementById("openModalBtn");
    const closeModalBtn = document.getElementById("closeModalBtn");
    const suggestModal = document.getElementById("suggestModal");

    openModalBtn.addEventListener("click", () => {
      suggestModal.classList.add("active");
    });
    closeModalBtn.addEventListener("click", () => {
      suggestModal.classList.remove("active");
    });
    window.addEventListener("keydown", (e) => {
      if (e.key === "Escape") {
        suggestModal.classList.remove("active");
      }
    });
    suggestModal.addEventListener("click", (e) => {
      if (e.target === suggestModal) {
        suggestModal.classList.remove("active");
      }
    });

    const suggestForm = document.getElementById("suggestColorForm");
    suggestForm.addEventListener("submit", async function (e) {
      e.preventDefault();
      const hex = document.getElementById("suggestHex").value.trim();
      const name = document.getElementById("suggestName").value.trim();
      const url = document.getElementById("suggestUrl").value.trim();
      const btn = suggestForm.querySelector('button[type="submit"]');
      btn.disabled = true;
      btn.textContent = "Submitting...";
      try {
        const res = await fetch(
          "https://hexcolor-words.netlify.app/netlify/functions/suggest-color",
          {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ hex, name, url }),
          }
        );
        const data = await res.json();
        if (res.ok && data.pr_url) {
          alert(
            "Thank you! Your suggestion was submitted.\nPull request: " +
              data.pr_url
          );
          suggestForm.reset();
          document.getElementById("suggestModal").classList.remove("active");
        } else {
          alert("Error: " + (data.message || "Could not create pull request."));
        }
      } catch (err) {
        alert("Network error: " + err.message);
      }
      btn.disabled = false;
      btn.textContent = "Submit";
    });
  });
</script>
